<div data-turbo='false'>
  <%= form_for(@review) do |f| %>
    <%= f.hidden_field :company_id, value: @review.company_id %>
    <%= f.hidden_field :user_id, value: @review.user_id %>
    <%= f.hidden_field :chief_id, value: @review.chief_id %>

    <%= f.fields_for :ratings do |ff| %>
      <div class='stars' style='display: block;'>
        <%= ff.hidden_field :style, value: ff.object.style %>
        <span>
          <%= ff.label ff.object.style, class: 'inline' %>
        </span>
        <%= ff.number_field :score, id: ff.object.style, class: 'hidden' %>
        <div class="outer-stars">
          <div class='inner-stars' id="inner-stars-<%= ff.object.style %>" style="width: <%= @review.star_width(num: ff.object.score) %>%">
            <%= @review.stars(style: ff.object.style, num: 5) %>
          </div>
          <div class='inner-starso' style='cursor: pointer;'>
            <%= @review.starso(style: ff.object.style) %>
          </div>
        </div>
      </div>
    <% end %>

    <%= f.label :message %>
    <%= f.text_area :message, required: true %>
    <%= f.submit('Submit For Approval') %>
  <% end %>
</div>

<script>
  for (const val of document.getElementsByClassName('fa-star')) {
    val.onmouseover = function(e) {
      starHover(this)
    };
    val.onmouseout = function(e) {
      starClear(this)
    };
    val.onclick = function(e) {
      starClick(this)
    }
  }
  function starClick(that) {
    let values = getStarVariables(that);
    setStarElementWidth(values['type'], values['value']);
    setStarElementValue(values['element'], values['value']);
  }

  function starHover(that) {
    let values = getStarVariables(that);
    setStarElementWidth(values['type'], values['value']);
  }

  function starClear(that) {
    let values = getStarVariables(that);
    setStarElementWidth(values['type'], values['originalValue']);
  }

  function getStarVariables(that) {
    let type = that.dataset.type;
    let element = document.getElementById(type);
    return {
      value: that.dataset.value,
      type: type,
      element: element,
      originalValue: element.value
    }
  }

  function setStarElementValue(element, value) {
    element.setAttribute('value', value);
  }

  function setStarElementWidth(type, value) {
    let starElement = document.getElementById('inner-stars-' + type);
    let width = 20 * value + '%';
    starElement.style.width = width;
    console.log(width)
  }

</script>
